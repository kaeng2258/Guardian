<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Chat Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>STOMP Chat Test</h2>
<button id="btnConnect">Connect</button>
<button id="btnSend">Send</button>
<pre id="log"></pre>

<script>
    let client;
    const roomId = 1;
    const log = (m)=>document.getElementById('log').textContent += m + "\n";

    document.getElementById('btnConnect').onclick = () => {
      const sock = new SockJS('/ws-stomp');
      client = Stomp.over(sock);
      client.connect({}, () => {
        log('âœ… Connected');
        client.subscribe(`/topic/room/${roomId}`, msg => {
          log('ğŸ“© ' + msg.body);
        });
        log(`âœ… Subscribed: /topic/room/${roomId}`);
      }, e => log('âŒ ' + e));
    };

    document.getElementById('btnSend').onclick = () => {
      if (!client || !client.connected) return log('âš ï¸ not connected');
      client.send(`/app/signal/${roomId}`, {}, JSON.stringify({
        sender: 'tester',
        content: 'hello guardian'
      }));
      log('ğŸ“¤ sent');
    };
</script>
</body>
</html>
